name: "food-convnet"
train_steps: 50
gpu: 1
train_one_batch {
  alg: kBP
}
updater{
  type: kSGD
  weight_decay:0.0005
  momentum:0.9
  learning_rate {
    type: kFixedStep
    fixedstep_conf:{
      step:0
      step: 100000
      step: 150000
      step_lr:0.0008
      step_lr:0.0001
      step_lr:0.00001
    }
  }
}
neuralnet {
  layer{
    name: "data"
    type: kDummy
    dummy_conf{
    input: true
      #random_skip: 1000
      shape: 96
      shape: 3
      shape: 224
      shape: 224
    }
  }
  layer{
    name: "label"
    type: kDummy
    dummy_conf{
    input: true
      #random_skip: 1000
      shape: 96
      shape: 1
    }
  }

  layer {
    name: "conv1_1"
    type: kCudnnConv
    srclayers: "data"
    convolution_conf {
      num_filters: 64
      kernel: 3
      stride: 1
      pad:1
    }
    param {
      name: "w1_1"
      init {
        type: kGaussian
        std: 0.01
      }
    }
    param {
      name: "b1_1"
      init {
        type: kConstant
        value:0
      }
    }
  }
  layer {
    name: "relu1_1"
    type: kCudnnActivation
    activation_conf {
      type: RELU
    }
    share_src_blobs: true
    srclayers:"conv1_1"
  }
  layer {
    name: "conv1_2"
    type: kCudnnConv
    srclayers: "relu1_1"
    convolution_conf {
      num_filters: 64
      kernel: 3
      stride: 1
      pad:1
    }
    param {
      name: "w1_2"
      init {
        type: kGaussian
        std: 0.01
      }

    }
    param {
      name: "b1_2"
      init {
        type: kConstant
        value:0
      }
    }
  }
  layer {
    name: "relu1_2"
    type: kCudnnActivation
    activation_conf {
      type: RELU
    }
    share_src_blobs: true
    srclayers:"conv1_2"
  }
  layer {
    name: "pool1_1"
    type: kCudnnPool
    srclayers: "relu1_2"
    pooling_conf {
      pool: MAX
      kernel: 2
      stride: 2
    }
  }

  layer {
    name: "conv2_1"
    type: kCudnnConv
    srclayers: "pool1_1"
    convolution_conf {
      num_filters: 128
      kernel: 3
      stride: 1
      pad:1
    }
    param {
      name: "w2_1"
      init {
        type: kGaussian
        std: 0.01
      }

    }
    param {
      name: "b2_1"
      init {
        type: kConstant
        value:0
      }
    }
  }
  layer {
    name: "relu2_1"
    type: kCudnnActivation
    activation_conf {
      type: RELU
    }
    share_src_blobs: true
    srclayers:"conv2_1"
  }

  layer {
    name: "conv2_2"
    type: kCudnnConv
    srclayers: "relu2_1"
    convolution_conf {
      num_filters: 128
      kernel: 3
      stride: 1
      pad:1
    }
    param {
      name: "w2_2"
      init {
        type: kGaussian
        std: 0.01
      }

    }
    param {
      name: "b2_2"
      init {
        type: kConstant
        value:0
      }
    }
  }
  layer {
    name: "relu2_2"
    type: kCudnnActivation
    activation_conf {
      type: RELU
    }
    share_src_blobs: true
    srclayers:"conv2_2"
  }

  layer {
    name: "pool2_1"
    type: kCudnnPool
    srclayers: "relu2_2"
    pooling_conf {
      pool: MAX
      kernel: 2
      stride: 2
    }
  }

  layer {
    name: "conv3_1"
    type: kCudnnConv
    srclayers: "pool2_1"
    convolution_conf {
      num_filters: 256
      kernel: 3
      stride: 1
      pad:1
    }
    param {
      name: "w3_1"
      init {
        type: kGaussian
        std: 0.01
      }

    }
    param {
      name: "b3_1"
      init {
        type: kConstant
        value:0
      }
    }
  }
  layer {
    name: "relu3_1"
    type: kCudnnActivation
    activation_conf {
      type: RELU
    }
    share_src_blobs: true
    srclayers:"conv3_1"
  }

  layer {
    name: "conv3_2"
    type: kCudnnConv
    srclayers: "relu3_1"
    convolution_conf {
      num_filters: 256
      kernel: 3
      stride: 1
      pad:1
    }
    param {
      name: "w3_2"
      init {
        type: kGaussian
        std: 0.01
      }

    }
    param {
      name: "b3_2"
      init {
        type: kConstant
        value:0
      }
    }
  }
  layer {
    name: "relu3_2"
    type: kCudnnActivation
    activation_conf {
      type: RELU
    }
    share_src_blobs: true
    srclayers:"conv3_2"
  }

  layer {
    name: "pool3_1"
    type: kCudnnPool
    srclayers: "relu3_2"
    pooling_conf {
      pool: MAX
      kernel: 2
      stride: 2
    }
  }


  layer {
    name: "conv4_1"
    type: kCudnnConv
    srclayers: "pool3_1"
    convolution_conf {
      num_filters: 512
      kernel: 3
      stride: 1
      pad:1
    }
    param {
      name: "w4_1"
      init {
        type: kGaussian
        std: 0.01
      }

    }
    param {
      name: "b4_1"
      init {
        type: kConstant
        value:0
      }
    }
  }
  layer {
    name: "relu4_1"
    type: kCudnnActivation
    activation_conf {
      type: RELU
    }
    share_src_blobs: true
    srclayers:"conv4_1"
  }

  layer {
    name: "conv4_2"
    type: kCudnnConv
    srclayers: "relu4_1"
    convolution_conf {
      num_filters: 512
      kernel: 3
      stride: 1
      pad:1
    }
    param {
      name: "w4_2"
      init {
        type: kGaussian
        std: 0.01
      }

    }
    param {
      name: "b4_2"
      init {
        type: kConstant
        value:0
      }
    }
  }
  layer {
    name: "relu4_2"
    type: kCudnnActivation
    activation_conf {
      type: RELU
    }
    share_src_blobs: true
    srclayers:"conv4_2"
  }

  layer {
    name: "pool4_1"
    type: kCudnnPool
    srclayers: "relu4_2"
    pooling_conf {
      pool: MAX
      kernel: 2
      stride: 2
    }
  }

  layer {
    name: "conv5_1"
    type: kCudnnConv
    srclayers: "pool4_1"
    convolution_conf {
      num_filters: 512
      kernel: 3
      stride: 1
      pad:1
    }
    param {
      name: "w5_1"
      init {
        type: kGaussian
        std: 0.01
      }

    }
    param {
      name: "b5_1"
      init {
        type: kConstant
        value:0
      }
    }
  }
  layer {
    name: "relu5_1"
    type: kCudnnActivation
    activation_conf {
      type: RELU
    }
    share_src_blobs: true
    srclayers:"conv5_1"
  }
  layer {
    name: "conv5_2"
    type: kCudnnConv
    srclayers: "relu5_1"
    convolution_conf {
      num_filters: 512
      kernel: 3
      stride: 1
      pad:1
    }
    param {
      name: "w5_2"
      init {
        type: kGaussian
        std: 0.01
      }

    }
    param {
      name: "b5_2"
      init {
        type: kConstant
        value:0
      }
    }
  }
  layer {
    name: "relu5_2"
    type: kCudnnActivation
    activation_conf {
      type: RELU
    }
    share_src_blobs: true
    srclayers:"conv5_2"
  }
  layer {
    name: "pool5_1"
    type: kCudnnPool
    srclayers: "relu5_2"
    pooling_conf {
      pool: MAX
      kernel: 2
      stride: 2
    }
  }
  layer {
    name: "ip1"
    type: kInnerProduct
    srclayers:"pool5_1"
    innerproduct_conf {
      num_output: 2
    }
    param {
      name: "w_ip1"
      init {
        type: kGaussian
        std: 0.01
      }

    }
    param {
      name: "b_ip1"
      init {
        type: kConstant
        value:0
      }
    }
  }
  layer {
    name: "relu_ip1"
    type: kCudnnActivation
    activation_conf {
      type: RELU
    }
    share_src_blobs: true
    srclayers:"ip1"
  }

  layer {
    name: "dropout1"
    type: kDropout
    #share_src_blobs: true
    srclayers: "relu_ip1"
  }
  layer {
    name: "loss"
    type: kCudnnSoftmaxLoss
    softmaxloss_conf {
      topk: 1
    }
    srclayers: "dropout1"
    srclayers: "label"
  }
}

cluster {
  nworker_groups: 1
  nserver_groups: 1
  nworkers_per_group: 2
  nworkers_per_procs: 1
  workspace: "examples/vgg"
}
